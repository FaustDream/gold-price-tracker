# 对话历史记录 - v1.3 深度修复闪退与打包方案优化 (2026-02-28)

## 核心上下文
用户反馈软件在进行 UI 修复和重新打包后仍然出现闪退。

## 关键决策
1.  **闪退深度分析**：
    -   通过日志分析，确认了 `java.lang.NoClassDefFoundError: javafx/scene/input/MouseEvent$Flags` 错误。
    -   **根本原因**：之前的打包方式使用了 `maven-shade-plugin` 将 JavaFX 所有的 JAR 包强行合并成一个 Uber-JAR。这种方式会破坏 JavaFX 的模块化结构，导致运行时无法正确加载内部类（如 `MouseEvent$Flags`）。
2.  **打包方案重构**：
    -   **废弃 Shade 插件**：在 `pom.xml` 中移除了 `maven-shade-plugin`。
    -   **引入依赖管理**：改用 `maven-dependency-plugin` 将所有依赖（JavaFX、OkHttp、JNA 等）原封不动地复制到 `target/libs` 目录下。
    -   **模块化打包**：让 `jpackage` 直接从 `target/libs` 中读取各个独立的 JAR 包进行打包。这样 `jpackage` 能正确识别模块信息并进行优化，彻底解决了类加载导致的闪退问题。
3.  **代码健壮性增强**：
    -   在 `DashboardController.java` 中补全了 `MouseEvent` 的显式导入。
    -   对窗口位置加载逻辑 (`loadWindowPosition`) 增加了异常捕获，防止配置文件损坏导致崩溃。
4.  **最终产物验证**：
    -   重新生成了免安装 EXE 版本。
    -   确认了文件夹命名为 `gold-price-tracker-1.3.0.exe`，内部主程序也已重命名。

## 项目进展
- 解决了最顽固的 JavaFX 模块化运行崩溃问题。
- 软件现在采用更标准、更稳定的原生模块打包方式。
- 功能已全部正常：上下排列价格、默认停靠任务栏、手动拖拽自由移动。

---
*记录人: AI 助手*
